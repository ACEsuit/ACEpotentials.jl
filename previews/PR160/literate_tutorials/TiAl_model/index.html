<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The acemodel interface from Julia (TiAl potential) · ACEpotentials.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://ACEsuit.github.io/ACEpotentials.jl/literate_tutorials/TiAl_model/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ACEpotentials.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../gettingstarted/installation/">Installation Instructions</a></li><li><a class="tocitem" href="../../gettingstarted/pkg/">Using the Julia Package Manager</a></li><li><a class="tocitem" href="../../gettingstarted/aceintro/">Introduction to ACE Models</a></li><li><a class="tocitem" href="../../gettingstarted/parallel-fitting/">Parallel Fitting</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials Overview</a></li><li><a class="tocitem" href="../first_example_model/">First example</a></li><li class="is-active"><a class="tocitem" href>The <code>acemodel</code> interface from Julia (TiAl potential)</a></li><li><a class="tocitem" href="../TiAl_basis/">The <code>ace_basis</code> interface from Julia (TiAl)</a></li><li><a class="tocitem" href="../smoothness_priors/">Smoothness Priors</a></li><li><a class="tocitem" href="../dataset_analysis/">Elementary Dataset Analysis</a></li><li><a class="tocitem" href="../committee/">Committee Potentials</a></li><li><a class="tocitem" href="../descriptor/">ACE Descriptors</a></li><li><a class="tocitem" href="../../tutorials/lammps/">ACEpotentials potentials in LAMMPS</a></li><li><a class="tocitem" href="../../tutorials/python_ase/">python-<code>ase</code></a></li><li><a class="tocitem" href="../../tutorials/molly/">Using ACE potentials in Molly</a></li></ul></li><li><span class="tocitem">ACEpotentials Internals</span><ul><li><a class="tocitem" href="../../ACEpotentials/acepotentials_overview/">Overview</a></li><li><a class="tocitem" href="../../ACEpotentials/fit/">Fitting ACE</a></li><li><a class="tocitem" href="../../ACEpotentials/helpers/">Helper Functions</a></li><li><a class="tocitem" href="../../ACEpotentials/data/">Handling Data</a></li><li><a class="tocitem" href="../../ACEpotentials/basis/">Constructing Basis</a></li><li><a class="tocitem" href="../../ACEpotentials/solver/">Solvers</a></li><li><a class="tocitem" href="../../ACEpotentials/all_exported/">All ACEpotentials functions</a></li></ul></li><li><span class="tocitem">ACEfit Internals</span><ul><li><a class="tocitem" href="../../ACEfit/Fitting/">ACE1 and ACEfit</a></li><li><a class="tocitem" href="../../ACEfit/Solvers/">Least squares solvers</a></li></ul></li><li><span class="tocitem">Outdated</span><ul><li><a class="tocitem" href="../../tutorials/command_line_old/">OLD (!) Command line interface</a></li><li><a class="tocitem" href="../../tutorials/first_example_json/">Command Line JSON (TiAl)</a></li><li><a class="tocitem" href="../ACEpotentials_TiAl/">TiAl potential (ACEpotentials-julia)</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>The <code>acemodel</code> interface from Julia (TiAl potential)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The <code>acemodel</code> interface from Julia (TiAl potential)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ACEsuit/ACEpotentials.jl/blob/main/docs/src/tutorials/TiAl_model.jl#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="The-acemodel-interface-from-Julia-(TiAl-potential)"><a class="docs-heading-anchor" href="#The-acemodel-interface-from-Julia-(TiAl-potential)">The <code>acemodel</code> interface from Julia (TiAl potential)</a><a id="The-acemodel-interface-from-Julia-(TiAl-potential)-1"></a><a class="docs-heading-anchor-permalink" href="#The-acemodel-interface-from-Julia-(TiAl-potential)" title="Permalink"></a></h1><p>Start by importing the required libraries</p><pre><code class="language-julia hljs">using ACEpotentials</code></pre><p>We need a dataset <code>TiAl_tutorial.xyz</code> for this tutorial. Normally we would get the path to a datset and then use <code>read_extxyz</code> to load in the training set.</p><pre><code class="language-julia hljs"># (don&#39;t execute this block)
data_file = &quot;path/to/TiAl_tutorial.xyz&quot;
data = read_extxyz(data_file)</code></pre><p>For convenience we provide this dataset as a <a href="https://docs.julialang.org/en/v1/stdlib/Artifacts/">Julia artifact</a> and make it conveniently accessible via <code>ACEpotentials.example_dataset</code>. We keep only a small subset of the training structures to keep the regression problem small.</p><pre><code class="language-julia hljs">data, _, meta = ACEpotentials.example_dataset(&quot;TiAl_tutorial&quot;)
train_data = data[1:5:end];</code></pre><p>The next step is to generate a model</p><ul><li><code>order = 3</code> : We take 3-correlation, i.e. a 4-body potential,</li><li><code>totaldegree = 6</code> : a very low polynomial degree just for testing</li><li><code>rcut = 5.5</code> : this is a typical cutoff radius for metals</li></ul><p>These three are the most important approximation parameters to explore when trying to improve the fit-accuracy. There are many other parameters to explore, which are documented in <code>?acemodel</code>. Even further model refinements are possible by studying the internals of <code>ACE1.jl</code> and <code>ACE1x.jl</code>. We also specify a reference potential that will be added to the learned 2-body and many-body potential components. Here we use a one-body potential i.e. a reference atom energy for each individual species. Usage of a one-body reference potential generally results in very slightly reduced fit accuracy but significantly improved 2-body potentials with a realistic dimer shape and improved robustness in predictions.</p><pre><code class="language-julia hljs">model = acemodel(elements = [:Ti, :Al],
					  order = 3,
					  totaldegree = 6,
					  rcut = 5.5,
					  Eref = [:Ti =&gt; -1586.0195, :Al =&gt; -105.5954])
@show length(model.basis);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">length(model.basis) = 190</code></pre><p>The next line specifies the regression weights: in the least squares loss different observations are given different weights,</p><p class="math-container">\[  \sum_{R} \Big( w^E_R | E(R) - y_R^E |^2
           + w^F_R | {\rm forces}(R) - y_R^F |^2
           + w^V_R | {\rm virial}(R) - y_R^V |^2 \Big),\]</p><p>and this is specificed via the following dictionary. The keys correspond to the <code>config_type</code> of the training structures.</p><pre><code class="language-julia hljs">weights = Dict(
        &quot;FLD_TiAl&quot; =&gt; Dict(&quot;E&quot; =&gt; 60.0, &quot;F&quot; =&gt; 1.0 , &quot;V&quot; =&gt; 1.0 ),
        &quot;TiAl_T5000&quot; =&gt; Dict(&quot;E&quot; =&gt; 5.0, &quot;F&quot; =&gt; 1.0 , &quot;V&quot; =&gt; 1.0 ));</code></pre><p>To estimate the parameters we still need to choose a solver for the least squares system. In this tutorial we use the LSQR algorithm, for no specific reason at all. Many other solvers are available, and can be explored by looking at the documentation of <code>ACEfit.jl</code>.</p><pre><code class="language-julia hljs">solver = ACEfit.LSQR(damp = 1e-2, atol = 1e-6);</code></pre><p>ACE1.jl has a heuristic smoothness prior built in which assigns to each basis function <code>Bi</code> a scaling parameter <code>si</code> that estimates how &quot;rough&quot; that basis function is. The following line generates a regularizer (prior) with <code>si^q</code> on the diagonal, thus penalizing rougher basis functions and enforcing a smoother fitted potential.</p><pre><code class="language-julia hljs">P = smoothness_prior(model; p = 4)    #  (p = 4 is in fact the default)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">190×190 LinearAlgebra.Diagonal{Float64, Vector{Float64}}:
 2.0    ⋅     ⋅      ⋅      ⋅       ⋅   …    ⋅         ⋅        ⋅        ⋅ 
  ⋅   17.0    ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅   82.0     ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅   257.0     ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅   626.0      ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅   1297.0  …    ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
 ⋮                                 ⋮    ⋱                             
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅   …    ⋅         ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅      29.9748     ⋅        ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅      101.908     ⋅        ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅     154.616     ⋅ 
  ⋅     ⋅     ⋅      ⋅      ⋅       ⋅        ⋅         ⋅        ⋅     331.982</code></pre><p>We are now ready to estimate the parameters. We take a subset of the training data to speed up the tutorial. The prior is passed to the <code>acefit!</code> function via the <code>prior</code> keyword argument.</p><pre><code class="language-julia hljs">data_train = data[1:5:end]
acefit!(model, data_train; solver=solver, prior = P);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────────┬──────────┬───────┬────┬──────┬─────┐
│       Type │ #Configs │ #Envs │ #E │   #F │  #V │
├────────────┼──────────┼───────┼────┼──────┼─────┤
│   FLD_TiAl │       63 │   126 │ 63 │  378 │ 378 │
│ TiAl_T5000 │        3 │   310 │  3 │  930 │  18 │
├────────────┼──────────┼───────┼────┼──────┼─────┤
│      total │       66 │   436 │ 66 │ 1308 │ 396 │
│    missing │        0 │     0 │  0 │    0 │   0 │
└────────────┴──────────┴───────┴────┴──────┴─────┘
[ Info: Assembling linear problem.
[ Info:   - Creating feature matrix with size (1770, 190).
[ Info:   - Beginning assembly with processor count:  1.
Progress:   3%|█▎                                       |  ETA: 0:00:41Progress:   8%|███▏                                     |  ETA: 0:00:30Progress:  12%|█████                                    |  ETA: 0:00:26Progress:  27%|███████████▏                             |  ETA: 0:00:20Progress:  42%|█████████████████▍                       |  ETA: 0:00:15Progress:  47%|███████████████████▎                     |  ETA: 0:00:14Progress:  62%|█████████████████████████▌               |  ETA: 0:00:10Progress:  67%|███████████████████████████▍             |  ETA: 0:00:09Progress:  82%|█████████████████████████████████▌       |  ETA: 0:00:05Progress:  86%|███████████████████████████████████▍     |  ETA: 0:00:04Progress:  92%|█████████████████████████████████████▉   |  ETA: 0:00:02Progress: 100%|█████████████████████████████████████████| Time: 0:00:25
[ Info:   - Assembly completed.
[ Info: Assembling full weight vector.
┌ Warning: Need to apply preconditioner in LSQR.
└ @ ACEfit ~/.julia/packages/ACEfit/eR8hX/src/solvers.jl:93
damp  0.01
atol  1.0e-6
maxiter  100000
Converged after 275 iterations.
relative RMS error  0.004335374134750925</code></pre><p>We can display an error table as follows:</p><pre><code class="language-julia hljs">@info(&quot;Training Error Table&quot;)
ACEpotentials.linear_errors(data_train, model; weights=weights);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Training Error Table
[ Info: RMSE Table
┌────────────┬─────────┬──────────┬─────────┐
│       Type │ E [meV] │ F [eV/A] │ V [meV] │
├────────────┼─────────┼──────────┼─────────┤
│   FLD_TiAl │  10.353 │    0.093 │ 103.439 │
│ TiAl_T5000 │   1.159 │    0.449 │  50.818 │
├────────────┼─────────┼──────────┼─────────┤
│        set │  10.118 │    0.382 │ 101.639 │
└────────────┴─────────┴──────────┴─────────┘
[ Info: MAE Table
┌────────────┬─────────┬──────────┬─────────┐
│       Type │ E [meV] │ F [eV/A] │ V [meV] │
├────────────┼─────────┼──────────┼─────────┤
│   FLD_TiAl │   7.187 │    0.058 │  65.088 │
│ TiAl_T5000 │   1.132 │    0.350 │  36.712 │
├────────────┼─────────┼──────────┼─────────┤
│        set │   6.912 │    0.266 │  63.798 │
└────────────┴─────────┴──────────┴─────────┘</code></pre><p>We should of course also look at test errors, which can be done as follows. Depending on the choice of solver, and solver parameters, the test errors might be very poor. Exploring different parameters in different applications can lead to significantly improved predictions.</p><pre><code class="language-julia hljs">@info(&quot;Test Error Table&quot;)
test_data = data[2:10:end]
ACEpotentials.linear_errors(test_data, model; weights=weights);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Test Error Table
[ Info: RMSE Table
┌────────────┬─────────┬──────────┬─────────┐
│       Type │ E [meV] │ F [eV/A] │ V [meV] │
├────────────┼─────────┼──────────┼─────────┤
│   FLD_TiAl │  19.083 │    0.176 │ 115.139 │
│ TiAl_T5000 │  30.193 │    0.513 │ 113.792 │
├────────────┼─────────┼──────────┼─────────┤
│        set │  19.513 │    0.370 │ 115.099 │
└────────────┴─────────┴──────────┴─────────┘
[ Info: MAE Table
┌────────────┬─────────┬──────────┬─────────┐
│       Type │ E [meV] │ F [eV/A] │ V [meV] │
├────────────┼─────────┼──────────┼─────────┤
│   FLD_TiAl │  10.812 │    0.086 │  66.424 │
│ TiAl_T5000 │  30.193 │    0.418 │  87.676 │
├────────────┼─────────┼──────────┼─────────┤
│        set │  11.399 │    0.238 │  67.068 │
└────────────┴─────────┴──────────┴─────────┘</code></pre><p>If we want to save the fitted potentials to disk to later use we can use one of the following commands: the first saves the potential as an <code>ACE1.jl</code> compatible potential, while the second line exports it to a format that can be ready by the <code>pacemaker</code> code to be used within LAMMPS.</p><pre><code class="language-julia hljs">export2json(&quot;./TiAl_tutorial_pot.json&quot;, model)</code></pre><p>export to lammps (ML-PACE):</p><pre><code class="language-julia hljs">export2lammps(&quot;./TiAl_tutorial_pot.yace&quot;, model)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../first_example_model/">« First example</a><a class="docs-footer-nextpage" href="../TiAl_basis/">The <code>ace_basis</code> interface from Julia (TiAl) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 22 August 2023 17:54">Tuesday 22 August 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
