<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Some Experimental Features · ACEpotentials.jl</title><meta name="title" content="Some Experimental Features · ACEpotentials.jl"/><meta property="og:title" content="Some Experimental Features · ACEpotentials.jl"/><meta property="twitter:title" content="Some Experimental Features · ACEpotentials.jl"/><meta name="description" content="Documentation for ACEpotentials.jl."/><meta property="og:description" content="Documentation for ACEpotentials.jl."/><meta property="twitter:description" content="Documentation for ACEpotentials.jl."/><meta property="og:url" content="https://ACEsuit.github.io/ACEpotentials.jl/literate_tutorials/experimental/"/><meta property="twitter:url" content="https://ACEsuit.github.io/ACEpotentials.jl/literate_tutorials/experimental/"/><link rel="canonical" href="https://ACEsuit.github.io/ACEpotentials.jl/literate_tutorials/experimental/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ACEpotentials.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../gettingstarted/installation/">Installation</a></li><li><a class="tocitem" href="../../gettingstarted/saving-and-loading/">Saving and Loading Potentials</a></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/">Tutorials Overview</a></li><li><a class="tocitem" href="../first_example_model/">First example</a></li><li><a class="tocitem" href="../TiAl_model/">The <code>acemodel</code> interface</a></li><li><a class="tocitem" href="../TiAl_basis/">The <code>ace_basis</code> interface</a></li><li><a class="tocitem" href="../smoothness_priors/">Smoothness Priors</a></li><li><a class="tocitem" href="../dataset_analysis/">Elementary Dataset Analysis</a></li><li><a class="tocitem" href="../../tutorials/lammps/">ACEpotentials potentials in LAMMPS</a></li><li><a class="tocitem" href="../../tutorials/python_ase/">python-<code>ase</code></a></li><li><a class="tocitem" href="../../tutorials/molly/">Using ACE potentials in Molly</a></li><li><a class="tocitem" href="../descriptor/">ACE Descriptors</a></li><li><a class="tocitem" href="../committee/">Committee Potentials</a></li><li><a class="tocitem" href="../../tutorials/AtomsBase_interface/">AtomsBase Interface</a></li><li class="is-active"><a class="tocitem" href>Some Experimental Features</a></li></ul></li></ul></li><li><span class="tocitem">Additional Topics</span><ul><li><a class="tocitem" href="../../gettingstarted/parallel-fitting/">Parallel Fitting</a></li><li><a class="tocitem" href="../../gettingstarted/aceintro/">Introduction to ACE Models</a></li><li><a class="tocitem" href="../../ACEpotentials/all_exported/"><code>ACEpotentials.jl</code> API</a></li></ul></li><li><span class="tocitem">Outdated</span><ul><li><a class="tocitem" href="../../outdated/outdated/">Outdated</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Some Experimental Features</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Some Experimental Features</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ACEsuit/ACEpotentials.jl/blob/main/docs/src/tutorials/experimental.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Some-Experimental-Features"><a class="docs-heading-anchor" href="#Some-Experimental-Features">Some Experimental Features</a><a id="Some-Experimental-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Some-Experimental-Features" title="Permalink"></a></h1><p>This tutorial will go through a few experimental features that are made available but may not be fully tested and should note be relied upon.</p><pre><code class="language-julia hljs">using ACEpotentials</code></pre><p>We do a quick fit of a TiAl potential following the same steps as in the  TiAl model tutorial.</p><pre><code class="language-julia hljs">model = acemodel(elements = [:Ti, :Al], order = 3, totaldegree = 6,
					  rcut = 5.5, Eref = [:Ti =&gt; -1586.0195, :Al =&gt; -105.5954])
weights = Dict(&quot;FLD_TiAl&quot; =&gt; Dict(&quot;E&quot; =&gt; 60.0, &quot;F&quot; =&gt; 1.0 , &quot;V&quot; =&gt; 1.0 ),
               &quot;TiAl_T5000&quot; =&gt; Dict(&quot;E&quot; =&gt; 5.0, &quot;F&quot; =&gt; 1.0 , &quot;V&quot; =&gt; 1.0 ))
solver = ACEfit.LSQR(damp = 1e-2, atol = 1e-6);
P = smoothness_prior(model; p = 4)
data, _, meta = ACEpotentials.example_dataset(&quot;TiAl_tutorial&quot;)
data_train = data[1:5:end]
acefit!(model, data_train; solver=solver, prior = P);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────────┬──────────┬───────┬────┬──────┬─────┐
│<span class="sgr1">       Type </span>│<span class="sgr1"> #Configs </span>│<span class="sgr1"> #Envs </span>│<span class="sgr1"> #E </span>│<span class="sgr1">   #F </span>│<span class="sgr1">  #V </span>│
├────────────┼──────────┼───────┼────┼──────┼─────┤
│   FLD_TiAl │       63 │   126 │ 63 │  378 │ 378 │
│ TiAl_T5000 │        3 │   310 │  3 │  930 │  18 │
├────────────┼──────────┼───────┼────┼──────┼─────┤
│      total │       66 │   436 │ 66 │ 1308 │ 396 │
│    missing │        0 │     0 │  0 │    0 │   0 │
└────────────┴──────────┴───────┴────┴──────┴─────┘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Assembling linear problem.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>  - Creating feature matrix with size (1770, 190).
<span class="sgr36"><span class="sgr1">[ Info: </span></span>  - Beginning assembly with processor count:  1.
<span class="sgr32">Progress:   3%|█▎                                       |  ETA: 0:00:26</span><span class="sgr32">Progress:   8%|███▏                                     |  ETA: 0:00:21</span><span class="sgr32">Progress:  21%|████████▊                                |  ETA: 0:00:17</span><span class="sgr32">Progress:  26%|██████████▌                              |  ETA: 0:00:16</span><span class="sgr32">Progress:  30%|████████████▍                            |  ETA: 0:00:15</span><span class="sgr32">Progress:  38%|███████████████▌                         |  ETA: 0:00:13</span><span class="sgr32">Progress:  42%|█████████████████▍                       |  ETA: 0:00:12</span><span class="sgr32">Progress:  47%|███████████████████▎                     |  ETA: 0:00:11</span><span class="sgr32">Progress:  52%|█████████████████████▏                   |  ETA: 0:00:10</span><span class="sgr32">Progress:  56%|███████████████████████                  |  ETA: 0:00:09</span><span class="sgr32">Progress:  67%|███████████████████████████▍             |  ETA: 0:00:07</span><span class="sgr32">Progress:  71%|█████████████████████████████▎           |  ETA: 0:00:06</span><span class="sgr32">Progress:  76%|███████████████████████████████          |  ETA: 0:00:05</span><span class="sgr32">Progress:  80%|████████████████████████████████▉        |  ETA: 0:00:04</span><span class="sgr32">Progress:  85%|██████████████████████████████████▊      |  ETA: 0:00:03</span><span class="sgr32">Progress:  89%|████████████████████████████████████▋    |  ETA: 0:00:02</span><span class="sgr32">Progress:  94%|██████████████████████████████████████▌  |  ETA: 0:00:01</span><span class="sgr32">Progress:  98%|████████████████████████████████████████▍|  ETA: 0:00:00</span><span class="sgr32">Progress: 100%|█████████████████████████████████████████| Time: 0:00:20</span>
<span class="sgr36"><span class="sgr1">[ Info: </span></span>  - Assembly completed.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Assembling full weight vector.
<span class="sgr33"><span class="sgr1">┌ Warning: </span></span>Need to apply preconditioner in LSQR.
<span class="sgr33"><span class="sgr1">└ </span></span><span class="sgr90">@ ACEfit ~/.julia/packages/ACEfit/9u2t5/src/solvers.jl:94</span>
damp  0.01
atol  1.0e-6
maxiter  100000
Converged after 274 iterations.
relative RMS error  0.004351003180379171</code></pre><p>Next we convert the model to a new experimental evaluator that should be a lot faster - at least for small models.</p><pre><code class="language-julia hljs">fpot = ACEpotentials.Experimental.fast_evaluator(model);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Importing pair potential model
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Importing many-body potential
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Importing 1-body potential</code></pre><p>The predictions should be correct to within 10-13 digits.</p><pre><code class="language-julia hljs">for ntest = 1:10
   at = rattle!(rand(data), 0.01)
   E = energy(model.potential, at)
   E_fast = energy(fpot, at)
   @show abs(E - E_fast)
end;</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">abs(E - E_fast) = 0.0
abs(E - E_fast) = 2.2737367544323206e-13
abs(E - E_fast) = 1.1641532182693481e-10
abs(E - E_fast) = 0.0
abs(E - E_fast) = 2.2737367544323206e-13
abs(E - E_fast) = 0.0
abs(E - E_fast) = 2.2737367544323206e-13
abs(E - E_fast) = 0.0
abs(E - E_fast) = 2.2737367544323206e-13
abs(E - E_fast) = 0.0</code></pre><p>Now let&#39;s look at timings, they should be significantly faster for the new evaluator. Note that the speedup will be different depending on the size of the model and the architecture of the computer.</p><pre><code class="language-julia hljs">forces(model.potential, data[1]);
forces(fpot, data[1]);
print(&quot;Energy, old evaluator: &quot;)
@time for d in data; energy(model.potential, d); end
print(&quot;Energy, new evaluator: &quot;)
@time for d in data; energy(fpot, d); end
print(&quot;Forces, old evaluator: &quot;)
@time for d in data; forces(model.potential, d); end
print(&quot;Forces, new evaluator: &quot;)
@time for d in data; forces(fpot, d); end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Energy, old evaluator:   0.127719 seconds (2.00 M allocations: 92.023 MiB, 21.73% gc time)
Energy, new evaluator:   0.015651 seconds (1.65 k allocations: 479.297 KiB)
Forces, old evaluator:   0.211178 seconds (4.32 M allocations: 151.557 MiB, 18.39% gc time)
Forces, new evaluator:   0.031163 seconds (1.98 k allocations: 993.656 KiB)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorials/AtomsBase_interface/">« AtomsBase Interface</a><a class="docs-footer-nextpage" href="../../gettingstarted/parallel-fitting/">Parallel Fitting »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 2 May 2024 17:20">Thursday 2 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
