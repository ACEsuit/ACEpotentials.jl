<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>ACE1 and ACEfit · ACE1pack.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://ACEsuit.github.io/ACE1pack.jl/ACEfit/Fitting/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ACE1pack.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="../../gettingstarted/installation/">Installation Instructions</a></li><li><a class="tocitem" href="../../gettingstarted/pkg/">Using the Julia Package Manager</a></li><li><a class="tocitem" href="../../gettingstarted/aceintro/">Introduction to ACE Models</a></li><li><a class="tocitem" href="../../gettingstarted/parallel-fitting/">Parallel Fitting</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials Overview</a></li><li><a class="tocitem" href="../../literate_tutorials/first_example_model/">First example</a></li><li><a class="tocitem" href="../../literate_tutorials/TiAl_model/">The <code>acemodel</code> interface from Julia (TiAl potential)</a></li><li><a class="tocitem" href="../../literate_tutorials/TiAl_basis/">The <code>ace_basis</code> interface from Julia (TiAl)</a></li><li><a class="tocitem" href="../../literate_tutorials/descriptor/">ACE Descriptors</a></li><li><a class="tocitem" href="../../literate_tutorials/committee/">Committee Potentials</a></li><li><a class="tocitem" href="../../tutorials/lammps/">ACE1pack potentials in LAMMPS</a></li><li><a class="tocitem" href="../../tutorials/python_ase/">python-<code>ase</code></a></li></ul></li><li><span class="tocitem">Command line</span><ul><li><a class="tocitem" href="../../tutorials/command_line_old/">OLD (!) Command line interface</a></li></ul></li><li><span class="tocitem">ACE1pack Internals</span><ul><li><a class="tocitem" href="../../ACE1pack/ace1pack_overview/">Overview</a></li><li><a class="tocitem" href="../../ACE1pack/fit/">Fitting ACE</a></li><li><a class="tocitem" href="../../ACE1pack/helpers/">Helper Functions</a></li><li><a class="tocitem" href="../../ACE1pack/data/">Handling Data</a></li><li><a class="tocitem" href="../../ACE1pack/basis/">Constructing Basis</a></li><li><a class="tocitem" href="../../ACE1pack/solver/">Solvers</a></li><li><a class="tocitem" href="../../ACE1pack/all_exported/">All ACE1pack functions</a></li></ul></li><li><span class="tocitem">ACEfit Internals</span><ul><li class="is-active"><a class="tocitem" href>ACE1 and ACEfit</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#The-Least-Squares-Database"><span>The Least Squares Database</span></a></li><li class="toplevel"><a class="tocitem" href="#Solving-the-Linear-System"><span>Solving the Linear System</span></a></li></ul></li><li><a class="tocitem" href="../Solvers/">Least squares solvers</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">ACEfit Internals</a></li><li class="is-active"><a href>ACE1 and ACEfit</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>ACE1 and ACEfit</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ACEsuit/ACE1pack.jl/blob/main/docs/src/ACEfit/Fitting.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="ACE1-and-ACEfit"><a class="docs-heading-anchor" href="#ACE1-and-ACEfit">ACE1 and ACEfit</a><a id="ACE1-and-ACEfit-1"></a><a class="docs-heading-anchor-permalink" href="#ACE1-and-ACEfit" title="Permalink"></a></h1><p><code>ACE1.jl</code> defines functions from the space of local atomic environments <span>$\mathcal{X}$</span> to the space of real numbers <span>$\mathbb{R}$</span>. These functions respect physical symmetries such as invariance under rotation of the environment and permutation of equivalent atoms. This set of functions <span>$\{B_\nu \}_\nu$</span> may be treated as a basis of a space of such symmetric functions, allowing us to express a property of an atomic environment <span>$R \in \mathcal{X}$</span> as follows:</p><p class="math-container">\[y(R) = \sum_\nu c_\nu B_\nu(R)\]</p><p>Having explicitly constructed such a basis set, the coefficients <span>$c_\nu$</span> can be found by fitting the model to data <span>$\{ (R_i, y_i) \}_i$</span> and solving by, for instance, least squares:</p><p class="math-container">\[\mathbf{c} = \text{arg} \min_\mathbf{c} \sum_i \left( y_i - \sum_\nu c_\nu B_\nu(R_i) \right)^2 + \text{REG}\]</p><p><code>ACE1.jl</code> describes the symmetric basis set; <code>ACE1pack.jl</code> and <code>ACEfit.jl</code> handle the assembly and solution of the resulting least squares system, and provides a variety of methods for doing so including different regularization methods. <code>ACEfit.jl</code> also defines a generic <code>Data</code> type and <code>ACE1pack.jl</code> implements a version of this type which represents a labelled atomic configuration.</p><h1 id="The-Least-Squares-Database"><a class="docs-heading-anchor" href="#The-Least-Squares-Database">The Least Squares Database</a><a id="The-Least-Squares-Database-1"></a><a class="docs-heading-anchor-permalink" href="#The-Least-Squares-Database" title="Permalink"></a></h1><p>The minimisation problem above can be written:</p><p class="math-container">\[\mathbf{c} = \text{arg} \min_\mathbf{c} \| \mathbf{y} - \Psi \mathbf{c} \|^2\]</p><p>where <span>$y_i$</span> are the observations of the true function, and <span>$\Psi_{i \nu} = B_\nu(R_i)$</span> is the design matrix. <code>ACE1pack</code> and <code>ACEfit</code> construct the design matrix and the observation vector (from the basis and training configurations) and stores them in a database: <a href="https://github.com/ACEsuit/IPFitting.jl/blob/main/src/lsq_db.jl">[source]</a></p><pre><code class="language-julia hljs">dB = LsqDB(save_name, basis, train)</code></pre><p>If <code>save_name</code> is the empty string, the least squares system, which can be very large, is not saved to disk. Otherwise, <code>save_name</code> should be a string not including any file extension, which is added by... <code>basis</code> is the ACE1 basis. <code>train</code> is a <code>Vector</code> of ACE1pack <code>AtomsData</code> objects representing the training set. TODO also provides tools for reading and saving the atomic structures see <a href="../../ACE1pack/data/">File io (TO-ADD, currently points to ACE1pack data handling)</a>. </p><h3 id="Structure-of-the-Linear-System."><a class="docs-heading-anchor" href="#Structure-of-the-Linear-System.">Structure of the Linear System.</a><a id="Structure-of-the-Linear-System.-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-of-the-Linear-System." title="Permalink"></a></h3><p>Observations of the energy, forces and virial stresses of an atomic configuration can be used to train a model. Each scalar observable contributes one row to the linear system: An energy observation therefore contributes a single row, and the forces on all the of the N atoms in a configuration contribute 3N rows. Training configurations can also be distinguised from one another by setting the <code>configtype</code> field in the ACE1pack <code>AtomsData</code> object. The least squares database recognises the config type of a configuration, which can be used to apply different settings for different config types when fitting.</p><h1 id="Solving-the-Linear-System"><a class="docs-heading-anchor" href="#Solving-the-Linear-System">Solving the Linear System</a><a id="Solving-the-Linear-System-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-Linear-System" title="Permalink"></a></h1><p>Fitting is performed by calling <code>lsqfit</code>.</p><pre><code class="language-julia hljs">IP, lsqinfo = lsqfit(dB, solver=solver, weights=weights, Vref=Vref, error_table=true)</code></pre><p>arguments (see below for details):</p><ul><li>dB : <code>IPFitting.lsqDB</code>. The least sqaures system to be solved.</li><li>solver : <code>Dict()</code>. Specifies the solution method.</li><li>weights : <code>Dict()</code>. The weights of the different observations (rows) of the least squares system.</li><li>Vref : <code>Dict()</code>. A reference potential.</li><li>error_table : <code>bool</code> If <code>true</code> a table containing fitting errors is printed and stored in <code>lsqinfo</code>. </li></ul><p>returns:</p><ul><li>IP : The interatomic potential that can be evaluated on a new configuration.</li><li>lsqinfo : A dictionary of information about the least sqaures system and the solution process.</li></ul><h3 id="Solvers"><a class="docs-heading-anchor" href="#Solvers">Solvers</a><a id="Solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Solvers" title="Permalink"></a></h3><p>Once the linear system has been formed, several methods exist for solving it. Some involve modifying the above minimisation statement but still require the design matrix and observation vector. Currently there are 4 solvers implemented in IPFitting which are discussed in <a href="../Solvers/">solvers</a>.</p><h3 id="Weights"><a class="docs-heading-anchor" href="#Weights">Weights</a><a id="Weights-1"></a><a class="docs-heading-anchor-permalink" href="#Weights" title="Permalink"></a></h3><p>The weights dictionary can be used to rescale rows of the linear equation to emphasise some observations more than others. For instance, it may be useful to weight the rows of the linear system corresponding to the energy larger than those corresponding to forces, if there are many more force observations than energy observations. Different weight can also be set for different config types. An example for a database containing training data with config types <code>MD</code> and <code>Phonon</code>, might be:</p><pre><code class="language-julia hljs">weights = Dict(
        &quot;MD&quot; =&gt; Dict(&quot;E&quot; =&gt; 5.0, &quot;F&quot; =&gt; 1.0 , &quot;V&quot; =&gt; 1.0 ),
        &quot;Phonon&quot; =&gt; Dict(&quot;E&quot; =&gt; 10.0, &quot;F&quot; =&gt; 10.0 , &quot;V&quot; =&gt; 10.0 ))</code></pre><h3 id="Reference-potential"><a class="docs-heading-anchor" href="#Reference-potential">Reference potential</a><a id="Reference-potential-1"></a><a class="docs-heading-anchor-permalink" href="#Reference-potential" title="Permalink"></a></h3><p>It is also possible to suply a reference potential <span>$V$</span>, which acts as a baseline for the prediction. If a reference potential is supplied, the prediction is modelled as</p><p class="math-container">\[y(R) = V(R) + \sum_\nu c_\nu B_\nu(R)\]</p><p>To implement this, the least squares database subtracts the reference from the observations before forming the linear system. The energy of the uninteracting isolated atoms (a <code>OneBody</code> potential) is good reference potential:</p><pre><code class="language-julia hljs">Vref = OneBody(:Ti =&gt; -1586.0195, :Al =&gt; -105.5954)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../ACE1pack/all_exported/">« All ACE1pack functions</a><a class="docs-footer-nextpage" href="../Solvers/">Least squares solvers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Thursday 22 June 2023 13:09">Thursday 22 June 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
